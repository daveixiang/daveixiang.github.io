<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>What is a system call (Linux) | 項 思 偉 ~ Aal Izz Well!</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <header>

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="https://siweixiang.github.io//xin">項 思 偉 ~ aal izz well!</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/">~/筆記</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/categories/">~/分類</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/tags/">~/標籤</a>
      </li>
      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">What is a system call (Linux)</span></h1>

<h2 class="date">2017/02/02</h2>
<p class="terms">
  
  
  Categories: <a href="/categories/linux">linux</a> 
  
  
  
  Tags: <a href="/tags/linux">linux</a> <a href="/tags/kernel">kernel</a> <a href="/tags/syscall">syscall</a> <a href="/tags/asm">asm</a> 
  
  
</p>
</div>



<main>


<p>An application program makes a system call to get the operating
system to perform a service for it, like reading from a file.</p>

<h1 id="system-calls-in-32-bit-linux">System Calls in 32-bit Linux</h1>

<ul>
<li><p>To make a system call in <strong>32-bit</strong> Linux, place the system call number
in eax, then its arguments, in order, in <strong>ebx</strong>, <strong>ecx</strong>, <strong>edx</strong>,
<strong>esi</strong>, <strong>edi</strong>, and <strong>ebp</strong>, then invoke <strong>int 0x80</strong>.</p></li>

<li><p>Some system calls return information, usually in <strong>eax</strong>.</p></li>

<li><p>All registers are saved across the system call.</p></li>
</ul>

<pre><code class="language-asm">.section .data
mesg:
    .asciz &quot;Hello World\n&quot;
mesg_len = . - mesg

.section .text
.global _start
_start:                         # ELF entry point
    mov $4, %eax                # sys_write
    mov $1, %ebx                # STDOUT
    mov $mesg, %ecx             # buffer address
    mov $mesg_len, %edx         # buffer length
    int $0x80

    mov $1, %eax                # sys_exit
    mov $0, %ebx                # error code
    int $0x80
</code></pre>

<h1 id="system-calls-in-64-bit-linux">System Calls in 64-bit Linux</h1>

<ul>
<li><p>To make a system call in <strong>64-bit</strong> Linux, place the system call
number in <strong>rax</strong>, then its arguments, in order, in <strong>rdi</strong>,
<strong>rsi</strong>, <strong>rdx</strong>, <strong>r10</strong>, <strong>r8</strong>, and <strong>r9</strong>, then invoke syscall.</p></li>

<li><p>Some system calls return information, usually in <strong>rax</strong>.</p></li>

<li><p>The system call destroys <strong>rcx</strong> and <strong>r11</strong> but others registers
are saved across the system call.</p></li>
</ul>

<p>code 01</p>

<pre><code class="language-assembly">.section .data
mesg:
    .asciz &quot;Hello World\n&quot;
mesg_len = . - mesg

.section .text
.global _start
_start:                         # ELF entry point
    mov $1, %rax                # sys_write
    mov $1, %rdi                # STDOUT
    mov $mesg, %rsi             # buffer address
    mov $mesg_len, %rdx         # buffer length
    syscall
    mov %rax, %rbx

    mov $60, %rax               # sys_exit
    mov %rbx, %rdi              # 0
    syscall
</code></pre>

<p>code 02</p>

<pre><code class="language-asm">.data
_hello:
  .asciz &quot;hello world\n&quot;

.text
.globl _main
_main:
  subq $8, %rsp

  movb $0, %al
  leaq _hello(%rip), %rdi
  call _printf

  movq $0, %rdi
  call _exit
</code></pre>

</main>

    <footer>
      
<script async src="//yihui.name/js/center-img.js"></script>

      
      <hr/>
      &copy; [項思偉] 2017 | <a href="https://github.com/siweixiang">Github</a>
      
    </footer>
  </body>
</html>

