<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Multiple ways to access QEMU Machine Protocol (QMP) | 項 思 偉 ~ Aal Izz Well!</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <header>

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="https://siweixiang.github.io//xin">項 思 偉 ~ aal izz well!</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/">~/筆記</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/categories/">~/分類</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/tags/">~/標籤</a>
      </li>
      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">Multiple ways to access QEMU Machine Protocol (QMP)</span></h1>

<h2 class="date">2017/02/28</h2>
<p class="terms">
  
  
  Categories: <a href="/categories/qemu">qemu</a> 
  
  
  
  Tags: <a href="/tags/qemu">qemu</a> <a href="/tags/qmp">qmp</a> <a href="/tags/linux">linux</a> 
  
  
</p>
</div>



<main>


<p>QMP (QEMU Machine Protocol) is quiet useful. QMP allows applications
to communicate withh a running QEMU&rsquo;s instance. There ae a few
different ways to access the QEMU monitor to query the guest&rsquo;s
information, modify the guest state using the QMP commands.</p>

<h2 id="access-qmp-via-libvirt-s-qemu-monitor-command">Access QMP via libvirt’s qemu-monitor-command</h2>

<pre><code class="language-bash">virsh qemu-monitor-command ${domain-name} --pretty '{&quot;execute&quot;:&quot;query-kvm&quot;}'
</code></pre>

<h2 id="qmp-via-tcp-socket">QMP via tcp socket</h2>

<ul>
<li>launch an qemu instance:</li>
</ul>

<pre><code class="language-bash">qemu-system-x86_64 --enable-kvm -drive if=virtio,format=qcow2,index=0,file=cirros-0.3.5-x86_64-disk.img --qmp tcp:127.0.0.1:12345,server
</code></pre>

<p>and the output in the terminal like:</p>

<pre><code class="language-txt">QEMU waiting for connection on: disconnected:tcp:127.0.0.1:12345,serve
</code></pre>

<ul>
<li>launch another terminal to access the instance we have</li>
</ul>

<p>launched using telnet:</p>

<pre><code class="language-bash">telnet 127.0.0.1 12345
</code></pre>

<p>and the output like:</p>

<pre><code class="language-txt">Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
{&quot;QMP&quot;: {&quot;version&quot;: {&quot;qemu&quot;: {&quot;micro&quot;: 0, &quot;minor&quot;: 8, &quot;major&quot;: 2}, &quot;package&quot;: &quot;&quot;}, &quot;capabilities&quot;: []}}
</code></pre>

<ul>
<li>execute &lsquo;query-kvm&rsquo; command</li>
</ul>

<pre><code class="language-txt">{&quot;execute&quot; : &quot;qmp_capabilities&quot;}
{&quot;return&quot;: {}}
{&quot;execute&quot; : &quot;query-kvm&quot;}
{&quot;return&quot;: {&quot;enabled&quot;: true, &quot;present&quot;: true}}
</code></pre>

<h2 id="qmp-via-unix-socket">QMP via unix socket</h2>

<ul>
<li>launch an qemu instance with unix socket:</li>
</ul>

<pre><code class="language-bash">qemu-system-x86_64 --enable-kvm -drive if=virtio,format=qcow2,index=0,file=cirros-0.3.5-x86_64-disk.img -qmp unix:./qmp-sock,server
</code></pre>

<p>and the output in the terminal like:</p>

<pre><code class="language-txt">QEMU waiting for connection on: disconnected:unix:./qmp-sock,server
</code></pre>

<ul>
<li>access the instance we have launched using socat and rlwrap:</li>
</ul>

<pre><code class="language-bash">rlwrap socat UNIX-CONNECT:./qmp-sock STDIO
</code></pre>

<p>and the output like:</p>

<pre><code class="language-txt">{&quot;QMP&quot;: {&quot;version&quot;: {&quot;qemu&quot;: {&quot;micro&quot;: 0, &quot;minor&quot;: 8, &quot;major&quot;: 2}, &quot;package&quot;: &quot;&quot;}, &quot;capabilities&quot;: []}}
</code></pre>

</main>

    <footer>
      
<script async src="//yihui.name/js/center-img.js"></script>

      
      <hr/>
      &copy; [項思偉] 2017 | <a href="https://github.com/siweixiang">Github</a>
      
    </footer>
  </body>
</html>

