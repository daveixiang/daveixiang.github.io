<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Build Cross GCC Toolchain (TARGET:arm64) | 項 思 偉 ~ Aal Izz Well!</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <header>

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="https://siweixiang.github.io//xin">項 思 偉 ~ aal izz well!</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/">~/筆記</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/categories/">~/分類</a>
      </li>
      
      
      <li class="pull-right ">
        <a href="/tags/">~/標籤</a>
      </li>
      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">Build Cross GCC Toolchain (TARGET:arm64)</span></h1>

<h2 class="date">2017/02/25</h2>
<p class="terms">
  
  
  Categories: <a href="/categories/clan">clan</a> 
  
  
  
  Tags: <a href="/tags/clan">clan</a> <a href="/tags/gcc">gcc</a> 
  
  
</p>
</div>



<main>
<pre><code class="language-bash">export BASE_DIR=/src/cross/
export LOG_DIR=$BASE_DIR/log
export SRC_DIR=$BASE_DIR/src
export BUILD_DIR=$BASE_DIR/build
export INSTALL_DIR=$BASE_DIR/aarch64
export SYSROOT_DIR=$INSTALL_DIR/sysroot

export BINUTILS_SRC=$SRC_DIR/binutils-2.27
export KERNEL_SRC=$SRC_DIR/linux-4.4.51
export GCC_SRC=$SRC_DIR/gcc-5.4.0
export GLIBC_SRC=$SRC_DIR/glibc-2.25

export TARGET_MACH=aarch64-linux-gnu
export LINUX_ARCH=arm64
export BUILD_MACH=$(gcc -dumpmachine)

wrap_cmd() {
    stage=$1; shift
    LOGFILE=&quot;$LOG_DIR/$stage.log&quot;
    rm -rf &quot;$LOGFILE&quot;
    echo &quot;begin $stage&quot;
    for cmd in &quot;$@&quot;
    do
    echo &quot;begin $cmd&quot;
    eval &quot;$cmd &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;
    [ $? -ne 0 ] &amp;&amp; echo &quot;error&quot; &amp;&amp; exit 1
    echo &quot;end $cmd&quot;
    done
    echo &quot;end $stage&quot;
}

rm -rf $BUILD_DIR
mkdir -p $BUILD_DIR

wrap_cmd &quot;01.binutils_extract&quot; \
     &quot;rm -rf $BINUTILS_SRC&quot; \
     &quot;tar jxf $BINUTILS_SRC.tar.bz2 -C $SRC_DIR/&quot; \
     &quot;mkdir -p $BUILD_DIR/binutils&quot;

wrap_cmd &quot;02.binutils_configure&quot; &quot;cd $BUILD_DIR/binutils&quot; &quot;$BINUTILS_SRC/configure --prefix=$INSTALL_DIR --build=$BUILD_MACH --target=$TARGET_MACH --with-sysroot=$SYSROOT_DIR --disable-werror&quot;
wrap_cmd &quot;03.binutils_build&quot; &quot;cd $BUILD_DIR/binutils&quot; &quot;make -j$(nproc)&quot; &quot;make install&quot;

wrap_cmd &quot;04.linux_extract&quot; &quot;rm -rf $KERNEL_SRC&quot; &quot;tar zxf $KERNEL_SRC.tar.gz -C $SRC_DIR/&quot;
wrap_cmd &quot;05.linux_header_install&quot; &quot;cd $KERNEL_SRC&quot; &quot;make mrproper&quot; &quot;make ARCH=$LINUX_ARCH INSTALL_HDR_PATH=$SYSROOT_DIR/usr headers_install&quot;

wrap_cmd &quot;06.gcc_extract&quot; \
&quot;rm -rf $GCC_SRC&quot; \
&quot;rm -rf $BUILD_DIR/bootstrap-gcc&quot; \
&quot;tar jxf $GCC_SRC.tar.bz2 -C $SRC_DIR/&quot; \
&quot;sed -i -e '/k prot/agcc_cv_libc_provides_ssp=yes' $GCC_SRC/gcc/configure&quot; \
&quot;mkdir $BUILD_DIR/bootstrap-gcc&quot;

wrap_cmd &quot;07.gcc_configure&quot; \
&quot;cd $BUILD_DIR/bootstrap-gcc&quot; \
&quot;$GCC_SRC/configure --prefix=$INSTALL_DIR --build=$BUILD_MACH --host=$BUILD_MACH --target=$TARGET_MACH --without-headers --enable-boostrap --enable-languages='c' --disable-threads --enable-__cxa_atexit --disable-libmudflap --with-gnu-ld --with-gnu-as --disable-libssp --disable-libgomp --disable-nls --disable-shared&quot;

wrap_cmd &quot;08.gcc_build&quot; \
&quot;make -j$(nproc) all-gcc&quot; \
&quot;make install-gcc&quot; \
&quot;make -j$(nproc) all-target-libgcc&quot; \
&quot;make install-target-libgcc&quot;


wrap_cmd &quot;09.glibc_extract&quot; \
     &quot;rm -rf $GLIBC_SRC&quot; \
     &quot;rm -rf $BUILD_DIR/libc&quot; \
     &quot;tar jxf $GLIBC_SRC.tar.bz2 -C $SRC_DIR/&quot; \
     &quot;mkdir -pv $BUILD_DIR/libc&quot;

wrap_cmd &quot;10.glibc_configure&quot; \
     &quot;cd $BUILD_DIR/libc&quot; \
     &quot;echo 'libc_cv_forced_unwind=yes' &gt; config.cache&quot; &quot;echo 'libc_cv_c_cleanup=yes' &gt;&gt; config.cache&quot; \
     &quot;export PATH=$INSTALL_DIR/bin:$PATH&quot; &quot;export CC=${TARGET_MACH}-gcc&quot; &quot;export LD=${CROSS}-ld&quot; &quot;export AS=${TARGET_MACH}-as&quot; \
     &quot;$GLIBC_SRC/configure --prefix=/usr --build=$BUILD_MACH --host=$TARGET_MACH --with-headers=$SYSROOT_DIR/usr/include --config-cache --enable-kernel=2.6.32&quot;

wrap_cmd &quot;11.glibc_build&quot; \
     &quot;make -k install-headers cross_compiling=yes install_root=$SYSROOT_DIR&quot; \
     &quot;make -j$(nproc)&quot; \
     &quot;make install_root=$SYSROOT_DIR install&quot; \
     &quot;ln -sf $SYSROOT_DIR/lib64 $SYSROOT_DIR/lib&quot; \
     &quot;ln -sf $SYSROOT_DIR/usr/lib64 $SYSROOT_DIR/usr/lib&quot; \
     &quot;unset CC&quot; &quot;unset LD&quot; &quot;unset AS&quot;

wrap_cmd &quot;12.gcc-final-01_extract&quot; \
     &quot;rm -rf $GCC_SRC&quot; \
     &quot;rm -rf $BUILD_DIR/final-gcc-01&quot; \
     &quot;tar jxf $GCC_SRC.tar.bz2 -C $SRC_DIR/&quot; \
     &quot;mkdir -pv $BUILD_DIR/final-gcc-01&quot;

wrap_cmd &quot;13.gcc-final-01_configure&quot; \
     &quot;cd $BUILD_DIR/final-gcc-01&quot; \
     &quot;echo 'libc_cv_forced_unwind=yes' &gt; config.cache&quot; &quot;echo 'libc_cv_c_cleanup=yes' &gt;&gt; config.cache&quot; \
     &quot;$GCC_SRC/configure --prefix=$INSTALL_DIR --build=$BUILD_MACH --target=$TARGET_MACH --with-sysroot=$SYSROOT_DIR --enable-languages='c,c++' --with-gnu-as --with-gnu-ld --disable-multilib --disable-nls --enable-threads=posix --enable-long-longx&quot;

wrap_cmd &quot;14.gcc-final-01_build&quot; \
     &quot;make -j$(nproc) all-gcc&quot; \
     &quot;make install-gcc&quot;


wrap_cmd &quot;13.gcc-final-02_extract&quot; \
     &quot;rm -rf $BUILD_DIR/final-gcc-02&quot; \
     &quot;mkdir -pv $BUILD_DIR/final-gcc-02&quot;

wrap_cmd &quot;14.gcc-final-02_configure&quot; \
     &quot;cd $BUILD_DIR/final-gcc-02&quot; \
     &quot;echo 'libc_cv_forced_unwind=yes' &gt; config.cache&quot; &quot;echo 'libc_cv_c_cleanup=yes' &gt;&gt; config.cache&quot; \
     &quot;$GCC_SRC/configure --prefix=$INSTALL_DIR --build=$BUILD_MACH --target=$TARGET_MACH --with-sysroot=$SYSROOT_DIR --enable-languages='c,c++' --with-gnu-as --with-gnu-ld --disable-multilib --disable-nls --enable-threads=posix --disable-libssp --enable-long-longx --with-shared&quot;


wrap_cmd &quot;15.gcc-final-02_build&quot; \
     &quot;make -j$(nproc)&quot; \
     &quot;make install&quot;
</code></pre>

</main>

    <footer>
      
<script async src="//yihui.name/js/center-img.js"></script>

      
      <hr/>
      &copy; [項思偉] 2017 | <a href="https://github.com/siweixiang">Github</a>
      
    </footer>
  </body>
</html>

