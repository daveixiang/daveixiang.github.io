<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Oom on 項 思 偉 (Davei) ~ Aal Izz Well!</title>
    <link>https://daveixiang.github.io/tags/oom/index.xml</link>
    <description>Recent content in Oom on 項 思 偉 (Davei) ~ Aal Izz Well!</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <atom:link href="https://daveixiang.github.io/tags/oom/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>内存不够导致KVM OOM</title>
      <link>https://daveixiang.github.io/articles/2017_02_08_KVM_OOM_case/</link>
      <pubDate>Wed, 08 Feb 2017 00:00:00 +0000</pubDate>
      
      <guid>https://daveixiang.github.io/articles/2017_02_08_KVM_OOM_case/</guid>
      <description>&lt;ul&gt;
&lt;li&gt;KVM OOM&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;[451452.773003] [ pid ] uid tgid total_vm rss nr_ptes swapents oom_score_adj name
[451452.773008] [ 395] 0 395 9240 1094 21 44 0 systemd-journal
[451452.773010] [ 423] 0 423 29723 151 26 84 0 lvmetad
[451452.773011] [ 429] 0 429 10897 261 21 109 -1000 systemd-udevd
[451452.773013] [ 563] 0 563 13854 298 25 89 -1000 auditd
[451452.773015] [ 585] 997 585 131910 320 55 1795 0 polkitd
[451452.773016] [ 587] 0 587 6048 261 15 35 0 systemd-logind
[451452.773017] [ 590] 81 590 6133 229 16 45 -900 dbus-daemon
[451452.773018] [ 596] 0 596 4792 205 14 35 0 irqbalance
[451452.773019] [ 604] 996 604 28962 202 26 70 0 chronyd
[451452.773021] [ 608] 0 608 50303 140 37 113 0 gssproxy
[451452.773022] [ 634] 0 634 28845 157 11 23 0 ksmtuned
[451452.773023] [ 651] 0 651 10838 29 21 131 0 monitor
[451452.773024] [ 652] 0 652 10932 316 22 197 0 ovsdb-server
[451452.773025] [ 708] 0 708 11781 106 23 94 0 monitor
[451452.773026] [ 711] 0 711 104086 12963 53 0 0 ovs-vswitchd
[451452.773027] [ 1004] 0 1004 72396 413 41 133 0 rsyslogd
[451452.773028] [ 1007] 0 1007 138287 594 89 3087 0 tuned
[451452.773030] [ 1049] 0 1049 20617 95 42 193 -1000 sshd
[451452.773031] [ 1075] 0 1075 27509 165 11 29 0 agetty
[451452.773032] [ 1637] 0 1637 22409 229 43 258 0 master
[451452.773033] [ 1668] 89 1668 22479 465 43 262 0 qmgr
[451452.773034] [ 5574] 0 5574 74152 471 62 284 -900 virtlogd
[451452.773035] [ 5585] 107 5585 2301147 36294 695 239350 0 qemu-kvm
[451452.773036] [ 5586] 0 5586 4444 223 13 27 0 systemd-machine
[451452.773038] [ 5612] 107 5612 1310112 756316 1952 154981 0 qemu-kvm
[451452.773040] [20262] 0 20262 5114 77 14 55 0 nginx
[451452.773041] [20263] 99 20263 5223 251 15 55 0 nginx
[451452.773057] [21999] 0 21999 337110 4650 161 2518 0 libvirtd
[451452.773058] [15319] 107 15319 2339541 1568424 3415 88466 0 qemu-kvm
[451452.773060] [24795] 107 24795 2415262 1225954 2744 67490 0 qemu-kvm
[451452.773061] [ 5979] 0 5979 31556 343 19 0 0 crond
[451452.773062] [ 6051] 1000 6051 565 28 5 0 0 ETMDaemon
[451452.773063] [ 6057] 1000 6057 1077 563 6 0 0 vod_httpserver
[451452.773064] [ 6813] 89 6813 22435 684 43 0 0 pickup
[451452.773098] [ 6825] 0 6825 36424 912 73 0 0 sshd
[451452.773099] [ 6828] 0 6828 28879 306 13 0 0 bash
[451452.773100] [ 6849] 0 6849 46882 411 46 0 0 su
[451452.773101] [ 6850] 1000 6850 28879 324 13 0 0 bash
[451452.773103] [ 7371] 1000 7371 8372 3717 19 0 0 EmbedThunderMan
[451452.773104] [ 7644] 107 7644 1229016 1030910 2230 58 0 qemu-kvm
[451452.773106] [ 7707] 0 7707 26974 136 10 0 0 sleep
[451452.773107] Out of memory: Kill process 15319 (qemu-kvm) score 363 or sacrifice child
[451452.773263] Killed process 15319 (qemu-kvm) total-vm:9358164kB, anon-rss:6271848kB, file-rss:1824kB, shmem-rss:24kB
[451452.778118] CPU 2/KVM invoked oom-killer: gfp_mask=0xd0, order=0, oom_score_adj=0
[451452.778121] CPU 2/KVM cpuset=vcpu2 mems_allowed=0
[451452.778123] CPU: 0 PID: 5628 Comm: CPU 2/KVM Not tainted 3.10.0-514.2.2.el7.x86_64 #1
[451452.778124] Hardware name: MSI MS-7984/Z170 KRAIT GAMING (MS-7984), BIOS B.70 02/24/2016
[451452.778125] ffff8801821abec0 00000000ed5b1643 ffff880444607830 ffffffff816861cc
[451452.778127] ffff8804446078c0 ffffffff81681177 ffff88045aed3800 ffff880444607990
[451452.778129] ffff8804598c8a60 ffff8804446078e8 ffff8804446078b0 0000000000000000
[451452.778130] Call Trace:
[451452.778135]  [&amp;lt;ffffffff816861cc&amp;gt;] dump_stack+0x19/0x1b
[451452.778137]  [&amp;lt;ffffffff81681177&amp;gt;] dump_header+0x8e/0x225
[451452.778140]  [&amp;lt;ffffffff8118476e&amp;gt;] oom_kill_process+0x24e/0x3c0
[451452.778141]  [&amp;lt;ffffffff8118420d&amp;gt;] ? oom_unkillable_task+0xcd/0x120
[451452.778143]  [&amp;lt;ffffffff811842b6&amp;gt;] ? find_lock_task_mm+0x56/0xc0
[451452.778145]  [&amp;lt;ffffffff81184fa6&amp;gt;] out_of_memory+0x4b6/0x4f0
[451452.778147]  [&amp;lt;ffffffff81681c80&amp;gt;] __alloc_pages_slowpath+0x5d7/0x725
[451452.778149]  [&amp;lt;ffffffff8118b0b5&amp;gt;] __alloc_pages_nodemask+0x405/0x420
[451452.778151]  [&amp;lt;ffffffff811cf26a&amp;gt;] alloc_pages_current+0xaa/0x170
[451452.778152]  [&amp;lt;ffffffff811859de&amp;gt;] __get_free_pages+0xe/0x50
[451452.778168]  [&amp;lt;ffffffffa0693dd9&amp;gt;] mmu_topup_memory_caches+0x79/0x120 [kvm]
[451452.778175]  [&amp;lt;ffffffffa069b4fd&amp;gt;] tdp_page_fault+0x4d/0x220 [kvm]
[451452.778183]  [&amp;lt;ffffffffa0692e44&amp;gt;] kvm_mmu_page_fault+0x24/0x140 [kvm]
[451452.778186]  [&amp;lt;ffffffffa0938bb6&amp;gt;] handle_ept_violation+0x96/0x170 [kvm_intel]
[451452.778189]  [&amp;lt;ffffffffa0942119&amp;gt;] vmx_handle_exit+0x299/0xbe0 [kvm_intel]
[451452.778196]  [&amp;lt;ffffffffa068695b&amp;gt;] vcpu_enter_guest+0x3bb/0x1100 [kvm]
[451452.778203]  [&amp;lt;ffffffffa068ea3d&amp;gt;] kvm_arch_vcpu_ioctl_run+0xcd/0x450 [kvm]
[451452.778208]  [&amp;lt;ffffffffa0673a31&amp;gt;] kvm_vcpu_ioctl+0x2b1/0x640 [kvm]
[451452.778211]  [&amp;lt;ffffffff810f7bd2&amp;gt;] ? do_futex+0x122/0x5b0
[451452.778213]  [&amp;lt;ffffffff81212035&amp;gt;] do_vfs_ioctl+0x2d5/0x4b0
[451452.778215]  [&amp;lt;ffffffff81691cb1&amp;gt;] ? __do_page_fault+0x171/0x450
[451452.778221]  [&amp;lt;ffffffffa067d14c&amp;gt;] ? kvm_on_user_return+0x6c/0x80 [kvm]
[451452.778227]  [&amp;lt;ffffffffa067d154&amp;gt;] ? kvm_on_user_return+0x74/0x80 [kvm]
[451452.778229]  [&amp;lt;ffffffff812122b1&amp;gt;] SyS_ioctl+0xa1/0xc0
[451452.778235]  [&amp;lt;ffffffff816967c9&amp;gt;] system_call_fastpath+0x16/0x1b
[451452.778236] Mem-Info:
[451452.778238] active_anon:2951002 inactive_anon:854110 isolated_anon:0
 active_file:30 inactive_file:53 isolated_file:0
 unevictable:12969 dirty:2 writeback:0 unstable:0
 slab_reclaimable:38630 slab_unreclaimable:65953
 mapped:3197 shmem:968 pagetables:12225 bounce:0
 free:35050 free_pcp:110 free_cma:0
[451452.778240] Node 0 DMA free:15896kB min:64kB low:80kB high:96kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15980kB managed:15896kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:0kB slab_unreclaimable:0kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB free_pcp:0kB local_pcp:0kB free_cma:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes
[451452.778243] lowmem_reserve[]: 0 1954 15761 15761
[451452.778245] Node 0 DMA32 free:64300kB min:8372kB low:10464kB high:12556kB active_anon:896060kB inactive_anon:965416kB active_file:12kB inactive_file:204kB unevictable:6044kB isolated(anon):0kB isolated(file):0kB present:2247872kB managed:2003132kB mlocked:6044kB dirty:0kB writeback:0kB mapped:1848kB shmem:144kB slab_reclaimable:16136kB slab_unreclaimable:27572kB kernel_stack:1344kB pagetables:3416kB unstable:0kB bounce:0kB free_pcp:40kB local_pcp:36kB free_cma:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no
[451452.778248] lowmem_reserve[]: 0 0 13806 13806
[451452.778249] Node 0 Normal free:60004kB min:59144kB low:73928kB high:88716kB active_anon:10907948kB inactive_anon:2451024kB active_file:108kB inactive_file:8kB unevictable:45832kB isolated(anon):0kB isolated(file):0kB present:14401536kB managed:14137948kB mlocked:45832kB dirty:8kB writeback:0kB mapped:10940kB shmem:3728kB slab_reclaimable:138384kB slab_unreclaimable:236240kB kernel_stack:4000kB pagetables:45484kB unstable:0kB bounce:0kB free_pcp:400kB local_pcp:96kB free_cma:0kB writeback_tmp:0kB pages_scanned:203 all_unreclaimable? yes
[451452.778252] lowmem_reserve[]: 0 0 0 0
[451452.778253] Node 0 DMA: 0*4kB 1*8kB (U) 1*16kB (U) 0*32kB 2*64kB (U) 1*128kB (U) 1*256kB (U) 0*512kB 1*1024kB (U) 1*2048kB (M) 3*4096kB (M) = 15896kB
[451452.778259] Node 0 DMA32: 496*4kB (UEM) 345*8kB (UEM) 408*16kB (UE) 216*32kB (UEM) 202*64kB (UEM) 102*128kB (UE) 37*256kB (UE) 19*512kB (UE) 1*1024kB (M) 0*2048kB 0*4096kB = 64392kB
[451452.778265] Node 0 Normal: 3100*4kB (UEM) 2859*8kB (UE) 1356*16kB (UEM) 93*32kB (UE) 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 59944kB
[451452.778270] Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=1048576kB
[451452.778271] Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=2048kB
[451452.778272] 36732 total pagecache pages
[451452.778272] 33203 pages in swap cache
[451452.778273] Swap cache stats: add 753570, delete 720367, find 278546/292738
[451452.778274] Free swap  = 0kB
[451452.778274] Total swap = 2097148kB
[451452.778275] 4166347 pages RAM
[451452.778275] 0 pages HighMem/MovableOnly
[451452.778276] 127103 pages reserved
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;libvirt&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;case 01&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;error: Failed to start domain stack-src
error: internal error: process exited while connecting to monitor: pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6 -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5 -drive file=/var/lib/libvirt/images/stack-src.qcow2,format=qcow2,if=none,id=drive-virtio-disk0 -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -netdev tap,fd=33,id=hostnet0,vhost=on,vhostfd=35 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:78:10:dc,bus=pci.0,addr=0x3 -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -device usb-tablet,id=input0,bus=usb.0,port=1 -spice port=5904,addr=0.0.0.0,disable-t
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;case 02&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;error: Failed to start domain stack-src
error: internal error: process exited while connecting to monitor: warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.ds [bit 21]
warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.acpi [bit 22]
warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.ht [bit 28]
warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.tm [bit 29]
warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.pbe [bit 31]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.dtes64 [bit 2]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.monitor [bit 3]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.ds_cpl [bit 4]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.smx [bit 6]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.est [bit 7]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.tm2 [bit 8]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.xtpr [bit 14]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;case 03&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;error: Failed to start domain stack-src
error: internal error: qemu unexpectedly closed the monitor: warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.ds [bit 21]
warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.acpi [bit 22]
warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.ht [bit 28]
warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.tm [bit 29]
warning: host doesn&#39;t support requested feature: CPUID.01H:EDX.pbe [bit 31]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.dtes64 [bit 2]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.monitor [bit 3]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.ds_cpl [bit 4]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.smx [bit 6]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.est [bit 7]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.tm2 [bit 8]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.xtpr [bit 14]
warning: host doesn&#39;t support requested feature: CPUID.01H:ECX.pdcm [
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>